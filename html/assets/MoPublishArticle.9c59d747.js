import{M as F,i as I}from"./MoImageUploader.28d4cc1a.js";import{a as d}from"./article-service.mod.9ac4e188.js";import{c as S}from"./category-service.mod.aa5a9ba4.js";import{t as U}from"./tag-service.mod.774d7a87.js";import{E}from"./style.38dcc1e9.js";import{_ as A}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.5b561da9.js";const O={class:"mo-publish-article__form-left"},M={class:"mo-publish-article__form-right"},P={__name:"MoPublishArticle",props:{params:{type:Object,default:()=>({})},notSaved:{type:Boolean,default:!1}},emits:["update:notSaved"],setup(g,{emit:f}){const p=g,V=Vue.ref(),s=Vue.ref(!1),e=Vue.reactive({id:"",title:"",description:"",cover:"",content:"",categoryId:"",tagIds:[],imageFileList:[]}),c=Vue.ref(JSON.stringify(e)),n=Vue.reactive([]),u=Vue.reactive([]),h={title:[{required:!0,message:"\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:5,max:100,message:"\u6807\u9898\u957F\u5EA6\u5E94\u4E3A5~100",trigger:"blur"}],description:[{required:!0,message:"\u6458\u8981\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{min:5,max:300,message:"\u6458\u8981\u957F\u5EA6\u5E94\u4E3A5~300",trigger:"blur"}]};Vue.watch(e,l=>{f("update:notSaved",m(l)!==c.value)});const v=l=>{V.value.validate(async t=>{if(t){if(!l&&await ElementPlus.ElMessageBox.confirm("\u5F53\u524D\u6CA1\u6709\u6587\u7AE0\u5185\u5BB9\uFF0C\u662F\u5426\u4FDD\u5B58?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).catch(()=>"cancel")==="cancel")return;s.value=!0,e.cover=e.imageFileList[0]?e.imageFileList[0].url2:"",(e.id?d.update:d.add)(e).then(a=>{s.value=!1,ElementPlus.ElMessage({message:`\u6587\u7AE0${e.id?"\u66F4\u65B0":"\u6DFB\u52A0"}\u6210\u529F!`,type:"success",duration:2*1e3}),e.id=a.data.id,c.value=m(e)}).catch(a=>{s.value=!1})}})},b=l=>{d.info(l).then(t=>{for(const i in t.data)e[i]=t.data[i];e.tagIds=t.data.tags.map(i=>i.id),e.cover&&e.cover.trim()!==""&&(e.imageFileList=[{url:e.cover,url2:e.cover}]),c.value=m(e)}).catch(t=>{})},x=()=>{S.simpleList().then(l=>{n.splice(0,n.length),l.data.map(t=>n.push(t))}).catch(l=>{})},w=()=>{U.simpleList().then(l=>{u.splice(0,u.length),l.data.map(t=>u.push(t))}).catch(l=>{})},y=async(l,t)=>{const a=(await Promise.all(l.map(r=>I.upload(r)))).map(r=>r.data.fileURL);await Promise.all(a.map(r=>fetch(r,{mode:"no-cors"}))),t(a)},m=l=>{if(l.imageFileList.length>0){const t=Object.assign({},l);return t.imageFileList=[{url:l.imageFileList[0].url,url2:l.imageFileList[0].url2}],JSON.stringify(t)}return JSON.stringify(l)};return x(),w(),p.params.articleId&&b(p.params.articleId),(l,t)=>{const i=Vue.resolveComponent("el-input"),a=Vue.resolveComponent("el-form-item"),r=Vue.resolveComponent("el-option"),_=Vue.resolveComponent("el-select"),C=Vue.resolveComponent("el-form"),L=Vue.resolveComponent("el-header"),N=Vue.resolveComponent("el-main"),k=Vue.resolveComponent("el-container"),B=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createBlock(a,{class:"mo-publish-article"},{default:Vue.withCtx(()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(k,{class:"mo-publish-article__container"},{default:Vue.withCtx(()=>[Vue.createVNode(L,{class:"mo-publish-article__header"},{default:Vue.withCtx(()=>[Vue.createVNode(C,{class:"mo-publish-article__form",model:e,ref_key:"formComponent",ref:V,"label-width":"60px",rules:h},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",O,[Vue.createVNode(a,{class:"mo-publish-article__form-item",label:"\u6807\u9898",prop:"title"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{class:"mo-publish-article__title",modelValue:e.title,"onUpdate:modelValue":t[0]||(t[0]=o=>e.title=o),placeholder:"\u8BF7\u8F93\u5165\u6807\u9898\uFF08\u957F\u5EA65~100\uFF09",minlength:"5",maxlength:"100","show-word-limit":!0,clearable:""},null,8,["modelValue"])]),_:1}),Vue.createVNode(a,{class:"mo-publish-article__form-item",label:"\u5206\u7C7B"},{default:Vue.withCtx(()=>[Vue.createVNode(_,{class:"mo-publish-article__category",modelValue:e.categoryId,"onUpdate:modelValue":t[1]||(t[1]=o=>e.categoryId=o),placeholder:"\u672A\u5206\u7C7B"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(n,o=>(Vue.openBlock(),Vue.createBlock(r,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(a,{class:"mo-publish-article__form-item",label:"\u6807\u7B7E"},{default:Vue.withCtx(()=>[Vue.createVNode(_,{class:"mo-publish-article__tag",modelValue:e.tagIds,"onUpdate:modelValue":t[2]||(t[2]=o=>e.tagIds=o),"multiple-limit":3,placeholder:"\u65E0\u6807\u7B7E",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",clearable:""},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(u,o=>(Vue.openBlock(),Vue.createBlock(r,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(a,{class:"mo-publish-article__cover",label:"\u5C01\u9762"},{default:Vue.withCtx(()=>[Vue.createVNode(F,{"image-file-list":e.imageFileList,"onUpdate:image-file-list":t[3]||(t[3]=o=>e.imageFileList=o)},null,8,["image-file-list"])]),_:1})]),Vue.createElementVNode("div",M,[Vue.createVNode(a,{label:"\u6458\u8981",prop:"description"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:e.description,"onUpdate:modelValue":t[4]||(t[4]=o=>e.description=o),placeholder:"\u8BF7\u8F93\u5165\u6458\u8981\uFF08\u957F\u5EA65~300\uFF09",type:"textarea",rows:"6",minlength:"5",maxlength:"300","show-word-limit":!0},null,8,["modelValue"])]),_:1})])]),_:1},8,["model"])]),_:1}),Vue.createVNode(N,{class:"mo-publish-article__main"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(E),{class:"mo-publish-article__md-editor",modelValue:e.content,"onUpdate:modelValue":t[5]||(t[5]=o=>e.content=o),placeholder:"\u8BF7\u8F93\u5165\u6587\u7AE0\u5185\u5BB9",onOnUploadImg:y,onOnSave:v},null,8,["modelValue"])]),_:1})]),_:1})),[[B,s.value]])]),_:1})}}},z=A(P,[["__scopeId","data-v-d58e5e47"]]);export{z as default};
