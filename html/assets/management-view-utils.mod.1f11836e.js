import{s as w}from"./index.5b561da9.js";const z={create:({service:c,addOrUpdateComponent:p,listComponent:h,getSelectRows:l})=>{const s=Vue.reactive({toolbar:{key:""},pageSize:w.getObject("pageSize").admin,page:1,total:0}),a=Vue.reactive([]);h&&!l&&(l=()=>{const e=h.value.store;if(!e||!e.isSelected)throw new Error("\u5217\u8868\u7EC4\u4EF6\u5E94\u4E3Ael-table\u7EC4\u4EF6!");const t=[];for(let n=0;n<a.length;++n)e.isSelected(a[n])&&t.push(a[n]);return t});const m=e=>p.value.init(e),y=e=>{s.page=1,g(e,s.page,s.pageSize)},E=async(e,t)=>{await u(e)&&t()},B=e=>{ElementPlus.ElMessageBox.confirm("\u786E\u5B9A\u8981\u5220\u9664\u5417?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>d(e)).catch(()=>"cancel")},v=()=>{const e=l();e.length===0?ElementPlus.ElMessageBox.alert("\u8BF7\u9009\u62E9\u9700\u8981\u5220\u9664\u7684\u5143\u7D20!","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",type:"info"}):ElementPlus.ElMessageBox.confirm("\u786E\u5B9A\u8981\u5220\u9664\u6240\u9009\u5143\u7D20\u5417?","\u7CFB\u7EDF\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{const t=e.map(n=>n.id);f(t)}).catch(()=>"cancel")},u=async e=>await(e.id?c.update:c.add)(e).then(n=>(ElementPlus.ElMessage({message:`${e.id?"\u66F4\u65B0":"\u6DFB\u52A0"}\u6210\u529F\uFF01`,type:"success"}),i({page:1}),!0)).catch(n=>!1),d=async e=>{await c.remove(e).then(t=>{ElementPlus.ElMessage({message:"\u5220\u9664\u6210\u529F!",type:"success"}),i({removeSize:1})}).catch(t=>{})},f=async e=>{await c.removeBatch(e).then(t=>{ElementPlus.ElMessage({message:"\u6279\u91CF\u5220\u9664\u6210\u529F!",type:"success"}),i({removeSize:e.length})}).catch(t=>{})},i=e=>{var o,r;let t=0,n=1;e&&(typeof e=="number"?n=e:typeof e=="object"&&(t=(o=e==null?void 0:e.removeSize)!=null?o:t,n=(r=e==null?void 0:e.page)!=null?r:n)),n?s.page=n:t>0&&s.page>1&&a.length-t<1?s.page-=1:s.page=1,g({},s.page,s.pageSize)},g=async(e,t,n)=>{await c.list(e,t,n).then(o=>{a.splice(0,a.length),o.data.list.map(r=>a.push(r)),s.total=o.data.total}).catch(o=>{})};return{model:s,listData:a,getSelectRows:l,handleOpenAddOrUpdateDialog:m,handleSearch:y,handleAddOrUpdate:E,handleRemove:B,handleRemoveBatch:v,addOrUpdate:u,remove:d,removeBatch:f,refresh:i,list:g}}};export{z as m};
